<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soumettre un devis - Strivex</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="/" class="logo">Strivex</a>
      <div class="flex gap-2">
        <a href="/dashboard-printer.html" class="btn btn-outline">Retour Dashboard</a>
      </div>
    </div>
  </nav>

  <div class="container" style="max-width: 800px; margin-top: 2rem;">
    <h1 class="mb-3">Soumettre un devis</h1>

    <div id="alert-container"></div>

    <!-- Project info -->
    <div class="card mb-3">
      <div class="card-header">
        <h2 class="card-title">Informations du projet</h2>
      </div>
      <div class="card-body">
        <h3 id="project-title" class="mb-2">Lot de pièces mécaniques</h3>
        <p id="project-description" class="text-secondary mb-3">20 pièces identiques pour prototype industriel</p>
        <div class="grid grid-2">
          <div>
            <strong>Matériau demandé:</strong> <span id="project-material">PETG</span>
          </div>
          <div>
            <strong>Quantité:</strong> <span id="project-quantity">20</span>
          </div>
          <div>
            <strong>Budget client:</strong> <span id="project-budget">150-200 €</span>
          </div>
          <div>
            <strong>Délai souhaité:</strong> <span id="project-deadline">7 jours</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Quote form -->
    <form id="quote-form">
      <div class="card mb-3">
        <div class="card-header">
          <h2 class="card-title">Votre devis</h2>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label class="form-label" for="price">Prix total (€) *</label>
            <input type="number" class="form-input" id="price" required min="1" step="0.01" placeholder="150.00">
            <small class="text-secondary">Le client paiera ce montant. Vous recevrez 90% après commission.</small>
            <div id="price-breakdown" class="mt-2 hidden">
              <div class="card" style="background: #f0f9ff; border: 2px solid var(--primary-color);">
                <div class="card-body">
                  <div class="flex-between mb-2">
                    <span>Prix client:</span>
                    <strong><span id="client-price">0</span> €</strong>
                  </div>
                  <div class="flex-between mb-2">
                    <span class="text-secondary">Commission plateforme (10%):</span>
                    <span class="text-secondary">- <span id="commission">0</span> €</span>
                  </div>
                  <hr>
                  <div class="flex-between">
                    <strong>Vous recevrez:</strong>
                    <strong class="text-success" style="font-size: 1.25rem;"><span id="your-payment">0</span> €</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="grid grid-2">
            <div class="form-group">
              <label class="form-label" for="duration-value">Durée estimée *</label>
              <input type="number" class="form-input" id="duration-value" required min="1" placeholder="5">
            </div>

            <div class="form-group">
              <label class="form-label" for="duration-unit">Unité</label>
              <select class="form-select form-input" id="duration-unit">
                <option value="hours">Heures</option>
                <option value="days" selected>Jours</option>
                <option value="weeks">Semaines</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="delivery-date">Date de livraison estimée *</label>
            <input type="date" class="form-input" id="delivery-date" required>
          </div>

          <div class="form-group">
            <label class="form-label" for="message">Message au client *</label>
            <textarea class="form-textarea" id="message" required placeholder="Décrivez votre expertise, le process que vous utiliserez, la qualité attendue..."></textarea>
            <small class="text-secondary">Min 10 caractères, max 1000</small>
          </div>
        </div>
      </div>

      <!-- Optional: Cost breakdown -->
      <div class="card mb-3">
        <div class="card-header">
          <h2 class="card-title">Détails des coûts (optionnel)</h2>
        </div>
        <div class="card-body">
          <p class="text-secondary mb-3">Aidez le client à comprendre votre tarification</p>
          <div class="grid grid-2">
            <div class="form-group">
              <label class="form-label" for="cost-materials">Matériaux (€)</label>
              <input type="number" class="form-input" id="cost-materials" min="0" step="0.01" placeholder="40.00">
            </div>

            <div class="form-group">
              <label class="form-label" for="cost-labor">Main d'œuvre (€)</label>
              <input type="number" class="form-input" id="cost-labor" min="0" step="0.01" placeholder="80.00">
            </div>

            <div class="form-group">
              <label class="form-label" for="cost-shipping">Livraison (€)</label>
              <input type="number" class="form-input" id="cost-shipping" min="0" step="0.01" placeholder="15.00">
            </div>

            <div class="form-group">
              <label class="form-label" for="cost-other">Autres frais (€)</label>
              <input type="number" class="form-input" id="cost-other" min="0" step="0.01" placeholder="15.00">
            </div>
          </div>
        </div>
      </div>

      <!-- Submit -->
      <div class="flex gap-2">
        <button type="button" class="btn btn-outline" onclick="window.history.back()">Annuler</button>
        <button type="submit" class="btn btn-primary" style="flex: 1;">
          <span id="submit-text">Envoyer le devis</span>
          <span id="submit-loading" class="loading hidden"></span>
        </button>
      </div>
    </form>
  </div>

  <script src="/js/app.js"></script>
  <script>
    // Set minimum delivery date to tomorrow
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    document.getElementById('delivery-date').min = tomorrow.toISOString().split('T')[0];

    // Calculate price breakdown
    const priceInput = document.getElementById('price');
    priceInput.addEventListener('input', updatePriceBreakdown);

    function updatePriceBreakdown() {
      const price = parseFloat(priceInput.value) || 0;
      if (price > 0) {
        const commission = price * 0.10;
        const yourPayment = price * 0.90;

        document.getElementById('client-price').textContent = price.toFixed(2);
        document.getElementById('commission').textContent = commission.toFixed(2);
        document.getElementById('your-payment').textContent = yourPayment.toFixed(2);
        document.getElementById('price-breakdown').classList.remove('hidden');
      } else {
        document.getElementById('price-breakdown').classList.add('hidden');
      }
    }

    // Form submission
    document.getElementById('quote-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const message = document.getElementById('message').value;
      if (message.length < 10) {
        alert('Le message doit contenir au moins 10 caractères');
        return;
      }
      if (message.length > 1000) {
        alert('Le message ne peut pas dépasser 1000 caractères');
        return;
      }

      const submitText = document.getElementById('submit-text');
      const submitLoading = document.getElementById('submit-loading');
      const alertContainer = document.getElementById('alert-container');

      submitText.classList.add('hidden');
      submitLoading.classList.remove('hidden');
      alertContainer.innerHTML = '';

      // Simulate API call
      setTimeout(() => {
        alertContainer.innerHTML = '<div class="alert alert-success">✓ Devis envoyé avec succès! Le client sera notifié.</div>';

        setTimeout(() => {
          window.location.href = '/dashboard-printer.html';
        }, 1500);
      }, 1000);
    });
  </script>
</body>
</html>
